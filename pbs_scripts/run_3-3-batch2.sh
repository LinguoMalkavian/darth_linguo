#Run the experiments

source activate allen

cd /home/lab/home/lab/Pablo/darth_linguo

resfile="/home/lab/home/lab/Pablo/darth_linguo/results/consolidated/exp-3.3-multirun_resultsV1"
echo "exp_name,VA,AA,RV,total" > $resfile
prog_file="/home/lab/home/lab/Pablo/darth_linguo/results/consolidated/exp-3.3.2-multirun_progress"
echo "Started experiments" > $prog_file
experiments=(exp-3.3_uni-1-layer64-182_run10 exp-3.3_uni-1-layer64-182_run11 exp-3.3_uni-1-layer64-182_run12 exp-3.3_uni-1-layer64-182_run13 exp-3.3_uni-1-layer64-182_run14 exp-3.3_uni-1-layer64-182_run15 exp-3.3_uni-1-layer64-182_run16 exp-3.3_uni-1-layer64-182_run17 exp-3.3_uni-1-layer64-182_run18 exp-3.3_uni-1-layer64-182_run19 exp-3.3_uni-1-layer64-182_run20 exp-3.3_uni-1-layer64-182_run21 exp-3.3_uni-1-layer64-182_run22 exp-3.3_uni-1-layer64-182_run23 exp-3.3_uni-1-layer64-182_run24 exp-3.3_uni-1-layer64-182_run25 exp-3.3_uni-1-layer64-182_run26 exp-3.3_uni-1-layer64-182_run27 exp-3.3_uni-1-layer64-182_run28 exp-3.3_uni-1-layer64-182_run29 exp-3.3_uni-2-layer64-112_run10 exp-3.3_uni-2-layer64-112_run11 exp-3.3_uni-2-layer64-112_run12 exp-3.3_uni-2-layer64-112_run13 exp-3.3_uni-2-layer64-112_run14 exp-3.3_uni-2-layer64-112_run15 exp-3.3_uni-2-layer64-112_run16 exp-3.3_uni-2-layer64-112_run17 exp-3.3_uni-2-layer64-112_run18 exp-3.3_uni-2-layer64-112_run19 exp-3.3_uni-2-layer64-112_run20 exp-3.3_uni-2-layer64-112_run21 exp-3.3_uni-2-layer64-112_run22 exp-3.3_uni-2-layer64-112_run23 exp-3.3_uni-2-layer64-112_run24 exp-3.3_uni-2-layer64-112_run25 exp-3.3_uni-2-layer64-112_run26 exp-3.3_uni-2-layer64-112_run27 exp-3.3_uni-2-layer64-112_run28 exp-3.3_uni-2-layer64-112_run29 exp-3.3_uni-3-layer64-88_run10 exp-3.3_uni-3-layer64-88_run11 exp-3.3_uni-3-layer64-88_run12 exp-3.3_uni-3-layer64-88_run13 exp-3.3_uni-3-layer64-88_run14 exp-3.3_uni-3-layer64-88_run15 exp-3.3_uni-3-layer64-88_run16 exp-3.3_uni-3-layer64-88_run17 exp-3.3_uni-3-layer64-88_run18 exp-3.3_uni-3-layer64-88_run19 exp-3.3_uni-3-layer64-88_run20 exp-3.3_uni-3-layer64-88_run21 exp-3.3_uni-3-layer64-88_run22 exp-3.3_uni-3-layer64-88_run23 exp-3.3_uni-3-layer64-88_run24 exp-3.3_uni-3-layer64-88_run25 exp-3.3_uni-3-layer64-88_run26 exp-3.3_uni-3-layer64-88_run27 exp-3.3_uni-3-layer64-88_run28 exp-3.3_uni-3-layer64-88_run29 exp-3.3_uni-4-layer64-75_run10 exp-3.3_uni-4-layer64-75_run11 exp-3.3_uni-4-layer64-75_run12 exp-3.3_uni-4-layer64-75_run13 exp-3.3_uni-4-layer64-75_run14 exp-3.3_uni-4-layer64-75_run15 exp-3.3_uni-4-layer64-75_run16 exp-3.3_uni-4-layer64-75_run17 exp-3.3_uni-4-layer64-75_run18 exp-3.3_uni-4-layer64-75_run19 exp-3.3_uni-4-layer64-75_run20 exp-3.3_uni-4-layer64-75_run21 exp-3.3_uni-4-layer64-75_run22 exp-3.3_uni-4-layer64-75_run23 exp-3.3_uni-4-layer64-75_run24 exp-3.3_uni-4-layer64-75_run25 exp-3.3_uni-4-layer64-75_run26 exp-3.3_uni-4-layer64-75_run27 exp-3.3_uni-4-layer64-75_run28 exp-3.3_uni-4-layer64-75_run29 exp-3.3_bi-1-layer_64-121_run10 exp-3.3_bi-1-layer_64-121_run11 exp-3.3_bi-1-layer_64-121_run12 exp-3.3_bi-1-layer_64-121_run13 exp-3.3_bi-1-layer_64-121_run14 exp-3.3_bi-1-layer_64-121_run15 exp-3.3_bi-1-layer_64-121_run16 exp-3.3_bi-1-layer_64-121_run17 exp-3.3_bi-1-layer_64-121_run18 exp-3.3_bi-1-layer_64-121_run19 exp-3.3_bi-1-layer_64-121_run20 exp-3.3_bi-1-layer_64-121_run21 exp-3.3_bi-1-layer_64-121_run22 exp-3.3_bi-1-layer_64-121_run23 exp-3.3_bi-1-layer_64-121_run24 exp-3.3_bi-1-layer_64-121_run25 exp-3.3_bi-1-layer_64-121_run26 exp-3.3_bi-1-layer_64-121_run27 exp-3.3_bi-1-layer_64-121_run28 exp-3.3_bi-1-layer_64-121_run29 exp-3.3_bi-2-layer_64-67_run10 exp-3.3_bi-2-layer_64-67_run11 exp-3.3_bi-2-layer_64-67_run12 exp-3.3_bi-2-layer_64-67_run13 exp-3.3_bi-2-layer_64-67_run14 exp-3.3_bi-2-layer_64-67_run15 exp-3.3_bi-2-layer_64-67_run16 exp-3.3_bi-2-layer_64-67_run17 exp-3.3_bi-2-layer_64-67_run18 exp-3.3_bi-2-layer_64-67_run19 exp-3.3_bi-2-layer_64-67_run20 exp-3.3_bi-2-layer_64-67_run21 exp-3.3_bi-2-layer_64-67_run22 exp-3.3_bi-2-layer_64-67_run23 exp-3.3_bi-2-layer_64-67_run24 exp-3.3_bi-2-layer_64-67_run25 exp-3.3_bi-2-layer_64-67_run26 exp-3.3_bi-2-layer_64-67_run27 exp-3.3_bi-2-layer_64-67_run28 exp-3.3_bi-2-layer_64-67_run29 exp-3.3_bi-3-layer_64-52_run10 exp-3.3_bi-3-layer_64-52_run11 exp-3.3_bi-3-layer_64-52_run12 exp-3.3_bi-3-layer_64-52_run13 exp-3.3_bi-3-layer_64-52_run14 exp-3.3_bi-3-layer_64-52_run15 exp-3.3_bi-3-layer_64-52_run16 exp-3.3_bi-3-layer_64-52_run17 exp-3.3_bi-3-layer_64-52_run18 exp-3.3_bi-3-layer_64-52_run19 exp-3.3_bi-3-layer_64-52_run20 exp-3.3_bi-3-layer_64-52_run21 exp-3.3_bi-3-layer_64-52_run22 exp-3.3_bi-3-layer_64-52_run23 exp-3.3_bi-3-layer_64-52_run24 exp-3.3_bi-3-layer_64-52_run25 exp-3.3_bi-3-layer_64-52_run26 exp-3.3_bi-3-layer_64-52_run27 exp-3.3_bi-3-layer_64-52_run28 exp-3.3_bi-3-layer_64-52_run29 exp-3.3_bi-4-layer_64-44_run10 exp-3.3_bi-4-layer_64-44_run11 exp-3.3_bi-4-layer_64-44_run12 exp-3.3_bi-4-layer_64-44_run13 exp-3.3_bi-4-layer_64-44_run14 exp-3.3_bi-4-layer_64-44_run15 exp-3.3_bi-4-layer_64-44_run16 exp-3.3_bi-4-layer_64-44_run17 exp-3.3_bi-4-layer_64-44_run18 exp-3.3_bi-4-layer_64-44_run19 exp-3.3_bi-4-layer_64-44_run20 exp-3.3_bi-4-layer_64-44_run21 exp-3.3_bi-4-layer_64-44_run22 exp-3.3_bi-4-layer_64-44_run23 exp-3.3_bi-4-layer_64-44_run24 exp-3.3_bi-4-layer_64-44_run25 exp-3.3_bi-4-layer_64-44_run26 exp-3.3_bi-4-layer_64-44_run27 exp-3.3_bi-4-layer_64-44_run28 exp-3.3_bi-4-layer_64-44_run29)
let exp_num=${#experiments[@]}
echo $exp_num
let "count=0"


for exp_name in "${experiments[@]}"; 
do
    allennlp train /home/lab/home/lab/Pablo/darth_linguo/experiments/$exp_name.json -s /home/lab/home/lab/Pablo/darth_linguo/results/$exp_name --include-package allen_linguo
    bash /home/lab/home/lab/Pablo/darth_linguo/pbs_scripts/generate_predictions.sh $exp_name

    echo "Finished experiment $exp_name" >> $prog_file
    let 'count+=1'  
    now=$(date +"%c")
    echo "$count/$exp_num done at $now" >> $prog_file
    
    python python/extract_results.py $exp_name >> $resfile
    aws s3 sync results s3://linguo-death-star/darth_linguo/results
done
